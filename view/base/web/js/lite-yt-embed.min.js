/**
 * A lightweight youtube embed. Still should feel the same to the user, just MUCH faster to initialize and paint.
 *
 * Thx to these as the inspiration
 *   https://storage.googleapis.com/amp-vs-non-amp/youtube-lazy.html
 *   https://autoplay-youtube-player.glitch.me/
 *
 * Once built it, I also found these:
 *   https://github.com/ampproject/amphtml/blob/master/extensions/amp-youtube (ðŸ‘ðŸ‘)
 *   https://github.com/Daugilas/lazyYT
 *   https://github.com/vb/lazyframe
 */
class LiteYTEmbed extends HTMLElement{connectedCallback(){this.videoId=this.getAttribute("videoid");let e=this.querySelector(".lty-playbtn");this.playLabel=e&&e.textContent.trim()||this.getAttribute("playlabel")||"Play",this.quality=this.getAttribute("quality"),["hqdefault","sddefault","maxresdefault"].includes(this.quality)||(this.quality="hqdefault");const t=this.getAttribute("image");if(this.image=t?encodeURI(t):null,this.lazy="false"!==this.getAttribute("lazy"),this.lazy?this.lazyLoadBackgroundImage():this.addBackgroundImage(),e||((e=document.createElement("button")).type="button",e.classList.add("lty-playbtn"),this.append(e)),!e.textContent){const t=document.createElement("span");t.className="lyt-visually-hidden",t.textContent=this.playLabel,e.append(t)}this.addEventListener("pointerover",LiteYTEmbed.warmConnections,{once:!0}),this.addEventListener("click",e=>this.addIframe())}static addPrefetch(e,t,a){const i=document.createElement("link");i.rel=e,i.href=t,a&&(i.as=a),document.head.append(i)}static warmConnections(){LiteYTEmbed.preconnected||(LiteYTEmbed.addPrefetch("preconnect","https://www.youtube-nocookie.com"),LiteYTEmbed.addPrefetch("preconnect","https://www.google.com"),LiteYTEmbed.addPrefetch("preconnect","https://googleads.g.doubleclick.net"),LiteYTEmbed.addPrefetch("preconnect","https://static.doubleclick.net"),LiteYTEmbed.preconnected=!0)}static hasWebP(){let e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))&&0===e.toDataURL("image/webp").indexOf("data:image/webp")}addBackgroundImage(){let e=this.image;e||(e=LiteYTEmbed.hasWebP()?`https://i.ytimg.com/vi_webp/${this.videoId}/${this.quality}.webp`:`https://i.ytimg.com/vi/${this.videoId}/${this.quality}.jpg`),LiteYTEmbed.addPrefetch("preload",e,"image"),this.style.backgroundImage=`url("${e}")`}lazyLoadBackgroundImage(){const e=this,t=new IntersectionObserver(function(a,i){a.forEach(function(a){a.isIntersecting&&(e.addBackgroundImage(),t.unobserve(a.target))})});t.observe(this)}addIframe(){const e=new URLSearchParams(this.getAttribute("params")||[]);e.append("autoplay","1");const t=document.createElement("iframe");t.width=560,t.height=315,t.title=this.playLabel,t.allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture",t.allowFullscreen=!0,t.src=`https://www.youtube-nocookie.com/embed/${encodeURIComponent(this.videoId)}?${e.toString()}`,this.append(t),this.classList.add("lyt-activated"),this.querySelector("iframe").focus()}}customElements.define("lite-youtube",LiteYTEmbed);
